<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ctao.O2O.dao.ProductDao">
    <insert id="insertProduct" parameterType="com.ctao.O2O.entity.Product" useGeneratedKeys="true" keyProperty="productId" keyColumn="product_id">
        INSERT  INTO
        tb_product(product_name,product_desc,img_addr,
		normal_price,promotion_price,priority,create_time,
		last_edit_time,enable_status,product_category_id,
		shop_id)
		VALUES
		(#{productName},#{productDesc},#{imgAddr},
		#{normalPrice},#{promotionPrice},#{priority},#{createTime},
		#{lastEditTime},#{enableStatus},#{productCategory.productCategoryId},
		#{shop.shopId})
    </insert>
    <update id="udateProduct" parameterType="com.ctao.O2O.entity.Product">
        UPDATE
        tb_product
        <set>
            <if test="productName!=null">product_name = #{productName}</if>
            <if test="productDesc != null">product_desc = #{productDesc}</if>
            <if test="imgAddr != null">img_addr = #{imgAddr}</if>
            <if test="normalPrice != null">normal_price = #{normalPrice}</if>
            <if test="promotionPrice != null">promotion_price = #{promotionPrice}</if>
            <if test="priority != null">priority = #{priority}</if>
            <if test="createTime != null">create_time = #{createTime}</if>
            <if test="lastEditTime != null">last_edit_time = #{lastEditTime}</if>
            <if test="enableStatus != null">enable_status = #{enableStatus}</if>
            <if test="productCategory.productCategoryId != null">product_category_id = #{productCategory.productCategoryId}</if>
            <if test="enableStatus != null">enable_status = #{enableStatus}</if>
        </set>
        WHERE product_id = #{productId}
    </update>
    <select id="queryProductByProductId" resultType="com.ctao.O2O.entity.Product" parameterType="long">
        SELECT
        p.product_id,p.product_name,p.product_desc,p.img_addr,p.normal_price,
        p.promotion_price,p.priority,p.create_time,p.last_edit_time,
        p.enable_status,p.product_img_list,p.product_category,p.shop_id
        pm.product_img_id,pm.img_addr,pm.img_desc,pm.priority,pm.create_time,pm.product_id
        FROM
        tb_product p
        left join
        tb_product_img pm
        on
        p.product_id=pm.product_id
        WHERE
        product_id =#{product.productId}
    </select>
</mapper>